<page-header mainTitle="{{title}}"></page-header>

<!-- Initialize a hidden floorplan component if the images were not found -->
<floor-plan *ngIf="!hasFloorPlanImages && interactiveFloorplanSG"
			class="phd-hidden-floor-plan"
			[canForceSave]="true"
			[planId]="marketingPlanId.length === 1 ? marketingPlanId[0] : 0"
			[subGroup]="interactiveFloorplanSG"
			[priceBreakdown]="priceBreakdown"
			[selectedPointFilter]="(selectedPointFilter$ | async)"
			[enabledPointFilters]="(enabledPointFilters$ | async)"
			[scenarioStatus]="(scenarioStatus$ | async)"
			[complete]="isComplete"
			[inChangeOrder]="(isChangingOrder$ | async)"
			errorMessage=""
			[treeFilter]="(treeFilter$ | async)"
			[canOverride]="(canOverride$ | async)"
			[canConfigure]="(canConfigure$ | async)"
			(onFloorPlanSaved)="onFloorPlanSaved($event)">
</floor-plan>

<div class="d-flex justify-content-center">
	<div *ngIf="canDisplay" class="summary-container d-flex align-items-onLoadImage flex-column">
		<div class="position-relative phd-summary-header-image" *ngIf="summaryImages.length">
			<ngb-carousel [interval]="0" *ngIf="summaryImages.length > 0" [showNavigationIndicators]="false" [showNavigationArrows]="summaryImages.length > 1">
				<ng-template ngbSlide *ngFor="let image of summaryImages">
					<image [imageUrl]="image.imageUrl" [defaultImage]="defaultImage" crop="fill" gravity="auto" *ngIf="!image.hasDataUri"></image>

					<img [src]="image.imageUrl | safeUrl" *ngIf="image.hasDataUri" class="phd-ifp-image">
				</ng-template>
			</ngb-carousel>
		</div>

		<summary-header [pointStatusFilter]="(pointStatusFilter$ | async)"
						(pointStatusFilterChanged)="onPointStatusFilterChanged($event)"
						(toggleAllAttributesChanged)="onToggleAllAttributesChanged($event)"
						(toggleImagesChanged)="onToggleImagesChanged($event)"
						(isStickyChanged)="onIsStickyChanged($event)"
						(handingChanged)="onHandingChanged($event)"
						(removeDesignSelectionsClicked)="onRemoveDesignSelections()"
						[summaryHeader]="summaryHeader"
						[priceBreakdown]="priceBreakdown"
						[allowEstimates]="allowEstimates"
						[canEditHanding]="(canEditAgreement$ | async) && (canConfigure$ | async) && canEditHanding"
						[canConfigure]="canConfigure$ | async"
						[disableHanding]="disableHanding"
						[canOverride]="canOverride$ | async"
						[showRemoveDesignSelectionsButton]="showRemoveDesignSelectionsButton">
		</summary-header>

		<div class="tree-view d-flex flex-column" [class.phd-is-sticky]="isSticky">
			<ng-container *ngFor="let group of groups">
				<div class="group" *ngIf="group.subGroups.length > 0">
					<div class="label">
						<span>{{group.label}}</span>
						<div class="phd-group-detail">
							<span class="phd-group-subtotal-label">Subtotal : </span>
							<span class="phd-group-subtotal-amount"> {{getGroupSubTotals(group) | currency}} </span>
						</div>
					</div>
					<div class="sub-group d-flex flex-column justify-content-between" *ngFor="let subGroup of group.subGroups">
						<div class="header d-flex justify-content-between align-items-center">
							<span>{{subGroup.label}}</span>
						</div>
						<ng-container *ngFor="let dp of subGroup.points">
							<decision-point-summary *ngIf="dp | isFiltered:(pointStatusFilter$ | async)"
													[decisionPoint]="dp"
													[subGroup]="subGroup"
													[group]="group"
													[id]="dp.id"
													[@blink]="dp.id === fragment"
													[scenarioId]="(scenarioId$ | async)"
													[filtered]="dp | isFiltered:(pointStatusFilter$ | async)"
													[showImages]="showImages"
													[canEditAgreement]="(canEditAgreement$ | async) && (canConfigure$ | async) && canEditSummary">
							</decision-point-summary>
						</ng-container>
					</div>
				</div>
			</ng-container>
		</div>

		<summary-action-bar [isComplete]="isComplete"
							[selectedPointFilter]="(selectedPointFilter$ | async)"
							[enabledPointFilters]="(enabledPointFilters$ | async)"
							[priceBreakdown]="priceBreakdown"
							[scenarioStatus]="(scenarioStatus$ | async)"
							[hasFloorPlan]="hasFloorPlan"
							[inChangeOrder]="(isChangingOrder$ | async)"
							[canChange]="(canConfigure$ | async) && canEditSummary"
							[priceRangesCalculated]="priceRangesCalculated"
							(pointTypeFilterChanged)="onPointTypeFilterChanged($event)"
							(onBuildIt)="onBuildIt()"
							(onPrintPreview)="printPreview($event)">
		</summary-action-bar>
	</div>
</div>

<ng-template #monotonyConflictModal>
	<monotony-conflict-modal [monotonyConflict]="monotonyConflict"
							 (onNavigateToElevation)="navigateToElevation()"
							 (onNavigateToColorScheme)="navigateToColorScheme()"
							 (onNavigateToLot)="navigateToLot()">
	</monotony-conflict-modal>
</ng-template>
